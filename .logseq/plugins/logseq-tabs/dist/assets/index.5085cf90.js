import{r as x,R as u,u as O,f as B,a as K,j as m,b as C,c as $,p as S,d as _,k as W,e as F,g as G}from"./vendor.9e8dfab1.js";const j=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}};j();const U="1.0.0",z={id:"_pengx17-logseq-tabs"},H=()=>{const e=O(),[t,n]=u.useState("light");return u.useEffect(()=>(n(top.document.querySelector("html")?.getAttribute("data-theme")??(matchMedia("prefers-color-scheme: dark").matches?"dark":"light")),logseq.App.onThemeModeChanged(r=>{e()&&n(r.mode)})),[e]),t};async function V(e){if(!e)return null;const t=await logseq.Editor.getPage(e);if(t&&t.alias?.length>0){const r=(await logseq.DB.datascriptQuery(`
      [:find (pull ?p [*])
      :where
      [?a :block/name "${t?.name}"]
      [?p :block/alias ?a]]
    `)).flat().find(o=>o.properties?.alias?.some(s=>s.toLowerCase()===t?.name));if(r)return await logseq.Editor.getPage(r.name)}return t}const J=e=>new Promise(t=>setTimeout(t,e));function P(e){return"logseq-plugin-tabs:"+U+"/"+e}const Q=e=>{const t=localStorage.getItem(P(e));if(t)try{return JSON.parse(t)}catch{}return null},X=(e,t)=>{localStorage.setItem(P(t),JSON.stringify(e))};function Y(){const[e,t]=x.exports.useState(null),n=async()=>{const r=await logseq.App.getCurrentGraph();t(r?.path??null)};return u.useEffect(()=>(n(),logseq.App.onCurrentGraphChanged(()=>{n()})),[]),e}function Z(){const[e,t]=u.useState([]),n=Y();return u.useEffect(()=>{if(n){const o=Q(n);t(o??[])}},[n]),[e,o=>{if(n&&!B(e,o))return X(o,n),t(o)}]}function ee(e,t){let n=null;return(...r)=>{n&&clearTimeout(n),n=window.setTimeout(()=>{e(...r),n=null},t)}}function I(e,t=300){const n=b(e);return x.exports.useMemo(()=>ee(n,t),[n,t])}function te(e,t){const n=u.useRef(document.documentElement),r=K(n);u.useEffect(()=>{logseq.showMainUI();const o=top.document.querySelector("#head.cp__header"),s=top.document.querySelector("#main-content-container"),c=()=>{const{left:v,width:E}=s.getBoundingClientRect(),a=E-10;logseq.setMainUIInlineStyle({zIndex:9,userSelect:"none",position:"fixed",left:`${v}px`,top:`${o.offsetHeight+2}px`,height:e?"28px":"0px",width:r?"100%":t+"px",maxWidth:a+"px"})};c();const g=new ResizeObserver(c);return g.observe(s),()=>{g.disconnect()}},[e,t,r])}const A=()=>navigator.userAgent.includes("Mac");function b(e){const t=u.useRef();return u.useLayoutEffect(()=>{t.current=e}),u.useCallback((...n)=>t.current.apply(void 0,n),[])}const ne=e=>{const[t,n]=u.useState();return u.useEffect(()=>{const r=()=>n(e.current?.scrollWidth||0),o=new MutationObserver(()=>{r(),setTimeout(r,100),setTimeout(r,200),setTimeout(r,300)});return e.current&&(n(e.current.scrollWidth||0),o.observe(e.current,{childList:!0,subtree:!0,attributes:!0})),()=>o.disconnect()},[e]),t},oe=e=>{top?.document.querySelector("#main-container")?.scrollTo(e)},q=e=>Boolean(e.page),re=()=>{const e=I(b(()=>{window.document.hasFocus()&&(top.focus(),logseq.Editor.restoreEditingCursor())}),10);u.useEffect(()=>{let t=0;return t=setInterval(e,1e3),window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e),clearInterval(t)}})},se=()=>m("svg",{height:"1em",width:"1em",viewBox:"0 0 122.878 122.88",fill:"currentColor",children:m("g",{children:m("path",{d:"M1.426,8.313c-1.901-1.901-1.901-4.984,0-6.886c1.901-1.902,4.984-1.902,6.886,0l53.127,53.127l53.127-53.127 c1.901-1.902,4.984-1.902,6.887,0c1.901,1.901,1.901,4.985,0,6.886L68.324,61.439l53.128,53.128c1.901,1.901,1.901,4.984,0,6.886 c-1.902,1.902-4.985,1.902-6.887,0L61.438,68.326L8.312,121.453c-1.901,1.902-4.984,1.902-6.886,0 c-1.901-1.901-1.901-4.984,0-6.886l53.127-53.128L1.426,8.313L1.426,8.313z"})})});function h(e,t){function n(r,o){return r!=null&&o!=null&&r.toLowerCase()===o.toLowerCase()}return e?.page||t?.page?n(e?.uuid,t?.uuid):Boolean(n(e?.originalName,t?.originalName)||n(e?.name,t?.name)||e?.alias?.includes(t?.id))}const ie=u.forwardRef(({activePage:e,onClickTab:t,tabs:n,onCloseTab:r,onPinTab:o,onSwapTab:s},c)=>{const[g,v]=u.useState();u.useEffect(()=>{const a=()=>{v(void 0)};return document.addEventListener("dragend",a),()=>{document.removeEventListener("dragend",a)}},[]);const E=I(s,0);return m("div",{ref:c,"data-dragging":g!=null,className:"flex items-center h-full px-1",style:{width:"fit-content"},children:n.map(a=>{const w=h(a,e),T=i=>{i.stopPropagation(),r(a)},d=i=>{g&&(i.preventDefault(),i.dataTransfer.dropEffect="move",E(a,g))},f=i=>{i.dataTransfer.effectAllowed="move",v(a)},l=a.properties?.icon?a.properties?.icon:q(a)?"B":"P";return C("div",{onClick:()=>t(a),onDoubleClick:()=>o(a),onContextMenu:i=>{i.preventDefault(),console.log("Not implemented yet")},"data-active":w,"data-pinned":a.pinned,"data-dragging":g===a,draggable:!0,onDragOver:d,onDragStart:f,className:"logseq-tab group",children:[m("div",{className:"text-xs rounded border mr-1 px-1 inline light:bg-white dark:bg-dark",children:l}),C("span",{className:"logseq-tab-title",children:[a.originalName??a.name," ",q(a)&&`/ ${a.uuid?.substring(a.uuid.length-12)}`]}),a.pinned?m("span",{children:"\u{1F4CC}"}):m("button",{className:"close-button",onClick:T,children:m(se,{})})]},a.uuid??a.name)})})});function L(e){const t=e;return ce(t)??ae(t)}function ce(e){const t=e;if(t.tagName==="A"&&t.hasAttribute("data-ref")&&(t.className.includes("page-ref")||t.className.includes("tag")))return e.getAttribute("data-ref")}function ae(e){const t=e;if(t.tagName==="A"&&t.querySelector(".page-icon"))return Array.from(e.childNodes).find(n=>n.nodeName==="#text")?.textContent?.trim()}function N(e){return e.getAttribute("blockid")??e.querySelector("[blockid]")?.getAttribute("blockid")}function ue(e){u.useEffect(()=>{const t=async n=>{const r=n.composedPath()[0];if(A()?n.metaKey:n.ctrlKey){let s=null;if(L(r)){n.stopPropagation(),n.stopImmediatePropagation();const c=await V(L(r));c&&(s=c)}else if(N(r)){n.stopPropagation(),n.stopImmediatePropagation();const c=N(r);if(c){const g=await logseq.Editor.getBlock(c);if(g){const v=await logseq.Editor.getPage(g?.page.id);v&&(s={...v,...g})}}}s&&e(s,n.shiftKey)}};return top?.document.addEventListener("mousedown",t,!0),()=>{top?.document.removeEventListener("mousedown",t,!0)}},[e])}function le(e){const[t,n]=u.useState(null),r=u.useRef(t),o=b(async()=>{const s=await logseq.Editor.getCurrentPage();let c=null;s&&(c=e.find(g=>h(g,s))??null,c||(c=await logseq.Editor.getPage(s.name??s?.page.id)),c={...c,...s},c.scrollTop&&oe({top:c.scrollTop}),r.current=c),n(c)});return u.useEffect(()=>logseq.App.onRouteChanged(o),[o]),u.useEffect(()=>{let s=!1;async function c(){await J(1500),!r.current&&!s&&(await o(),await c())}return c(),()=>{s=!0}},[o]),[t,n]}const k=e=>{e.sort((t,n)=>t.pinned&&!n.pinned?-1:!t.pinned&&n.pinned?1:0)};function de(){const[e,t]=Z(),[n,r]=le(e),o=u.useRef(),s=$(e),c=b((d,f)=>{const l=e.findIndex(p=>h(p,d));if(e[l]?.pinned&&!f)return;const i=[...e];if(i.splice(l,1),t(i),i.length===0)logseq.App.pushState("home");else if(h(d,n)){const p=i[Math.min(i.length-1,l)];r(p)}}),g=b(async d=>{r(d);const f=e.findIndex(l=>h(l,o.current));if(f!==-1){const l=top?.document.querySelector("#main-container")?.scrollTop;t(S(e,i=>{i[f].scrollTop=l}))}}),v=b((d,f=!1)=>{d&&(e.every(l=>!h(d,l))?t([...e,d]):f=!0,f&&g(d))});ue(v),_(()=>{let d=0,f=s.current;const l=o.current;return n&&(f=S(e,i=>{if(e.every(p=>!h(p,n))){const p=i.findIndex(D=>h(D,l)),y=i[p]?.pinned;p===-1||y?i.push(n):i[p]=n}else{const p=i.findIndex(y=>h(y,n));i[p]=n}}),d=setTimeout(async()=>{const i=await logseq.Editor.getCurrentPage();h(n,i)||logseq.App.pushState("page",{name:q(n)?n.uuid:n.originalName??n.name})},200)),o.current=n,t(f),()=>{d&&clearTimeout(d)}},[n??{}]);const E=b(d=>{t(S(e,f=>{const l=f.findIndex(i=>h(i,d));f[l].pinned=!f[l].pinned,k(f)}))}),a=(d,f)=>{t(S(e,l=>{const i=l.findIndex(y=>h(y,d)),p=l.findIndex(y=>h(y,f));l[i]=f,l[p]=d,k(l)}))};u.useEffect(()=>{const d=new W.Keyboard(top);d.setLocale("us",F);const f=i=>{i.stopPropagation(),i.preventDefault(),o.current&&c(o.current)},l=A()?"command + w":"ctrl + w";return d.bind(l,f),()=>{d.unbind(l,f)}},[c]);const w=u.useRef(null),T=ne(w);return te(e.length>0,T),u.useEffect(()=>{n&&w&&setTimeout(()=>{w.current?.querySelector('[data-active="true"]')?.scrollIntoView({behavior:"smooth"})},100)},[n,w]),m(ie,{ref:w,onClickTab:g,activePage:n,tabs:e,onSwapTab:a,onPinTab:E,onCloseTab:c})}function fe(){const e=H();return re(),m("main",{style:{width:"100vw",height:"100vh"},className:`${e}`,children:m(de,{})})}const M=`__${z.id}__loaded__`;function R(){const e=logseq.baseInfo.id;console.info(`#${e}: MAIN`),G.render(m(u.StrictMode,{children:m(fe,{})}),document.getElementById("app")),top[M]=!0,console.info(`#${e}: MAIN DONE`)}top[M]?logseq.App.relaunch().then(R).catch(console.error):logseq.ready(R).catch(console.error);
